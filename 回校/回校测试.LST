C51 COMPILER V6.12  _校___                                                               02/23/2013 00:08:22 PAGE 1   


C51 COMPILER V6.12, COMPILATION OF MODULE _校___
OBJECT MODULE PLACED IN .\回校测试.OBJ
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE .\回校测试.c DEBUG OBJECTEXTEND

stmt level    source

   1          /*********************************************************************************************
   2          程序名： 　　 PWM模块调试程序（仅实验用）
   3          编写人： 　　 杜洋　
   4          编写时间：　　2009年7月22日
   5          硬件支持：　　STC12C2052  12MHz
   6          接口说明：　　LED灌电流接P3.7接口（PWM0）  
   7          修改日志：　　
   8          　　NO.1-								
   9          /*********************************************************************************************
  10          说明：
  11          
  12          /*********************************************************************************************/
  13          
  14          #include<STC12C2052AD.H> //头文件
  15          sbit LED = P1 ^ 7;
  16          sbit LED1 = P1 ^ 6;
  17          
  18          /*********************************************************************************************
  19          函数名：毫秒级CPU延时函数
  20          调  用：DELAY_MS (?);
  21          参  数：1~65535（参数不可为0）
  22          返回值：无
  23          结  果：占用CPU方式延时与参数数值相同的毫秒时间
  24          备  注：应用于1T单片机时i<600，应用于12T单片机时i<125
  25          /*********************************************************************************************/
  26          void DELAY_MS (unsigned int a){
  27   1      	unsigned int i;
  28   1      	while( a-- != 0){
  29   2      		for(i = 0; i < 600; i++);
  30   2      	}
  31   1      }
  32          /*********************************************************************************************/
  33          /*********************************************************************************************
  34          函数名：PWM初始化函数
  35          调  用：PWM_init();
  36          参  数：无
  37          返回值：无
  38          结  果：将PCA初始化为PWM模式，初始占空比为0
  39          备  注：需要更多路PWM输出直接插入CCAPnH和CCAPnL即可
  40          /**********************************************************************************************/
  41          void PWM_init (void){
  42   1      CMOD=0x02; //设置PCA定时器
  43   1       	CL=0x00; 
  44   1       	CH=0x00;
  45   1      
  46   1      	CCAPM0=0x42; //PWM0设置PCA工作方式为PWM方式（0100 0010）
  47   1       	CCAP0L=0x00; //设置PWM0初始值与CCAP0H相同
  48   1       	CCAP0H=0x00; // PWM0初始时为0
  49   1      
  50   1      	CCAPM1=0x42; //PWM1设置PCA工作方式为PWM方式（使用时删除//）
  51   1      	CCAP1L=0x00; //设置PWM1初始值与CCAP0H相同
  52   1       	CCAP1H=0x00; // PWM1初始时为0
  53   1      
  54   1      	//CCAPM2=0x42; //PWM2设置PCA工作方式为PWM方式
  55   1      	//CCAP2L=0x00; //设置PWM2初始值与CCAP0H相同
C51 COMPILER V6.12  _校___                                                               02/23/2013 00:08:22 PAGE 2   

  56   1       	//CCAP2H=0x00; // PWM2初始时为0
  57   1      
  58   1      	//CCAPM3=0x42; //PWM3设置PCA工作方式为PWM方式
  59   1      	//CCAP3L=0x00; //设置PWM3初始值与CCAP0H相同
  60   1       	//CCAP3H=0x00; // PWM3初始时为0
  61   1      
  62   1       	CR=1; //启动PCA定时器
  63   1      }
  64          /**********************************************************************************************/
  65          
  66          /*********************************************************************************************
  67          函数名：PWM0占空比设置函数
  68          调  用：PWM0_set();
  69          参  数：0x00~0xFF（亦可用0~255）
  70          返回值：无
  71          结  果：设置PWM模式占空比，为0时全部高电平，为1时全部低电平
  72          备  注：如果需要PWM1的设置函数，只要把CCAP0L和CCAP0H中的0改为1即可
  73          /**********************************************************************************************/
  74          void PWM0_set (unsigned char a){
  75   1      	CCAP0L= a; //设置值直接写入CCAP0L
  76   1       	CCAP0H= a; //设置值直接写入CCAP0H
  77   1      }
  78          /**********************************************************************************************/
  79          /*********************************************************************************************
  80          函数名：PWM1占空比设置函数
  81          调  用：PWM1_set();
  82          参  数：0x00~0xFF（亦可用0~255）
  83          返回值：无
  84          结  果：设置PWM模式占空比，为0时全部高电平，为1时全部低电平
  85          备  注：如果需要PWM1的设置函数，只要把CCAP0L和CCAP0H中的0改为1即可
  86          /**********************************************************************************************/
  87          void PWM1_set (unsigned char a){
  88   1      	CCAP1L= a; //设置值直接写入CCAP0L
  89   1       	CCAP1H= a; //设置值直接写入CCAP0H
  90   1      }
  91          /**********************************************************************************************/
  92          /*********************************************************************************************
  93          函数名：主函数
  94          调  用：无
  95          参  数：无
  96          返回值：无
  97          结  果：程序开始处，无限循环
  98          备  注：
  99          /**********************************************************************************************/
 100          void main (void){
 101   1      	PWM_init(); //PWM初始化
 102   1      	while(1){
 103   2      	unsigned char a;
 104   2      	for(a=0x00;a<0xff;a++){
 105   3      	PWM0_set(a); //设置PWM占空比
 106   3      	PWM1_set(~a); //设置PWM1占空比
 107   3      	DELAY_MS (20);
 108   3      	LED=0;
 109   3      	LED1=1;
 110   3      	}
 111   2      	for(a=0xff;a>0x00;a--){
 112   3      	PWM0_set(a); //设置PWM占空比
 113   3      	PWM1_set(~a); //设置PWM1占空比
 114   3      	DELAY_MS (20);
 115   3      	LED=1;
 116   3      	LED1=0;
 117   3      	}
C51 COMPILER V6.12  _校___                                                               02/23/2013 00:08:22 PAGE 3   

 118   2         }
 119   1      }
 120          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    124    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
